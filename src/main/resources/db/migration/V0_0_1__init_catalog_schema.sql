/*
Deployment script for Catalog

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/


PRINT N'Creating [Master]...';


GO
CREATE SCHEMA [Master]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [Master].[MasterUser]...';


GO
CREATE TABLE [Master].[MasterUser]
(
    [Id]                   INT IDENTITY (1, 1) NOT NULL,
    [FirstName]            NVARCHAR(255)       NULL,
    [LastName]             NVARCHAR(255)       NULL,
    [Email]                NVARCHAR(255)       NULL,
    [Login]                NVARCHAR(255)       NULL,
    [Password]             NVARCHAR(255)       NULL,
    [Token]                NVARCHAR(MAX)       NULL,
    [LastConnectedCompany] NVARCHAR(50)        NULL,
    [IsDeleted]            BIT                 NOT NULL,
    [TransactionUserId]    INT                 NULL,
    [Deleted_Token]        NVARCHAR(255)       NULL,
    [IsBToB]               BIT                 NULL,
    [AccountNonExpired] BIT NOT NULL DEFAULT(1),
    [AccountNonLocked] BIT NOT NULL DEFAULT(1),
    [Enabled] BIT NOT NULL DEFAULT(1),
    [CredentialsNonExpired] BIT NOT NULL DEFAULT(1),
    [Language]             NVARCHAR(50)        NULL
    CONSTRAINT [PK_MasterUser] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [Master].[Company]...';

GO
CREATE TABLE [Master].[MasterDbSettings]
(
    [Id]           INT IDENTITY (1, 1) NOT NULL,
    [Server]       NVARCHAR(MAX)       NOT NULL,
    [UserId]       NVARCHAR(MAX)       NOT NULL,
    [UserPassword] NVARCHAR(MAX)       NOT NULL,
    CONSTRAINT [PK_MasterDbSettings] PRIMARY KEY CLUSTERED ([Id] ASC)
);

GO
CREATE TABLE [Master].[MasterCompany]
(
    [Id]                 INT IDENTITY (1, 1) NOT NULL,
    [Code]               NVARCHAR(50)        NULL,
    [Name]               NVARCHAR(255)       NULL,
    [Email]              NVARCHAR(255)       NULL,
    [IsDeleted]          BIT                 NOT NULL,
    [TransactionUserId]  INT                 NULL,
    [Deleted_Token]      NVARCHAR(255)       NULL,
    [DataBaseName]       NVARCHAR(MAX)       NOT NULL,
    [IdMasterDbSettings] INT                 NULL,
    [GarageDataBaseName] NVARCHAR(255)       NULL,
    [DefaultLanguage]    NVARCHAR(50)        NULL,
    CONSTRAINT [PK_MasterCompany] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [Master].[UserCompany]...';


GO
CREATE TABLE [Master].[MasterUserCompany]
(
    [Id]                INT IDENTITY (1, 1) NOT NULL,
    [IdMasterUser]      INT                 NOT NULL,
    [IdMasterCompany]   INT                 NOT NULL,
    [IsDeleted]         BIT                 NOT NULL,
    [TransactionUserId] INT                 NULL,
    [Deleted_Token]     NVARCHAR(255)       NULL,
    [IsActif]           BIT                 NOT NULL DEFAULT ('true')
        CONSTRAINT [PK_MasterUserCompany] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [Master].[FK_UserCompany_Company]...';


GO
ALTER TABLE [Master].[MasterUserCompany]
    WITH NOCHECK
        ADD CONSTRAINT [FK_MasterUserCompany_MasterCompany] FOREIGN KEY ([IdMasterCompany]) REFERENCES [Master].[MasterCompany] ([Id]);


GO
PRINT N'Creating [Master].[FK_UserCompany_User]...';


GO
ALTER TABLE [Master].[MasterUserCompany]
    WITH NOCHECK
        ADD CONSTRAINT [FK_MasterUserCompany_MasterUser] FOREIGN KEY ([IdMasterUser]) REFERENCES [Master].[MasterUser] ([Id]);


GO
PRINT N'Checking existing data against newly created constraints';

GO
ALTER TABLE [Master].[MasterCompany]
    WITH NOCHECK
        ADD CONSTRAINT [FK_Company_DbSettings] FOREIGN KEY ([IdMasterDbSettings]) REFERENCES [Master].[MasterDbSettings] ([Id]);

GO

ALTER TABLE [Master].[MasterUserCompany]
    WITH CHECK CHECK CONSTRAINT [FK_MasterUserCompany_MasterCompany];

ALTER TABLE [Master].[MasterUserCompany]
    WITH CHECK CHECK CONSTRAINT [FK_MasterUserCompany_MasterUser];

GO
PRINT N'Update complete.';

--- houssem add licen curency  28-08-2020

/****** Object:  Table [Master].[CompanyLicence]    Script Date: 28/08/2020 14:21:10 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [Master].[CompanyLicence]
(
    [Id]              [int] IDENTITY (1,1) NOT NULL,
    [IdMasterCompany] [int]                NOT NULL,
    [NombreERPUser]   [int]                NOT NULL,
    [NombreB2BUser]   [int]                NOT NULL,
    [ExpirationDate]  [date]               NULL,
    [IntialDate]      [date]               NOT NULL,
    [IsDeleted]       [bit]                NOT NULL,
    [Deleted_Token]   [nvarchar](250)      NULL,
    CONSTRAINT [PK_CompanyLicence] PRIMARY KEY CLUSTERED
        (
         [Id] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [Master].[CompanyLicence]
    ADD CONSTRAINT [DF_Table_1_NombreOfUser] DEFAULT ((0)) FOR [NombreERPUser]
GO

ALTER TABLE [Master].[CompanyLicence]
    ADD CONSTRAINT [DF_CompanyLicence_NombreB2BUser] DEFAULT ((0)) FOR [NombreB2BUser]
GO

ALTER TABLE [Master].[CompanyLicence]
    ADD CONSTRAINT [DF_CompanyLicence_IntialDate] DEFAULT (getdate()) FOR [IntialDate]
GO

ALTER TABLE [Master].[CompanyLicence]
    WITH CHECK ADD CONSTRAINT [FK_CompanyLicence_MasterCompany] FOREIGN KEY ([IdMasterCompany])
        REFERENCES [Master].[MasterCompany] ([Id])
        ON DELETE CASCADE
GO

ALTER TABLE [Master].[CompanyLicence]
    CHECK CONSTRAINT [FK_CompanyLicence_MasterCompany]
GO

update Master.MasterUser
set IsBToB = 0
where IsBToB is null
alter table Master.MasterUser
    alter column IsBToB bit not null

ALTER TABLE [Master].[MasterUser]
    ADD CONSTRAINT [DF_MasterUser_IsBToB] DEFAULT ((0)) FOR [IsBToB]
GO



GO
/****** Object:  Schema [Master]    Script Date: 22/09/2020 15:15:15 ******/
IF (NOT EXISTS(SELECT *
               FROM sys.schemas
               WHERE name = 'Master'))
    BEGIN
        EXEC ('CREATE SCHEMA [Master]')
    END
GO
GO
/****** Object:  Table [Master].[MasterModule]    Script Date: 24/09/2020 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [Master].[MasterModule]
(
    [Id]   int IDENTITY (1,1) NOT NULL,
    [Code] [varchar](255)          NULL,
    PRIMARY KEY CLUSTERED
        (
         [Id] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
    CONSTRAINT [PK_MasterModule] UNIQUE NONCLUSTERED
        (
         [Code] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [Master].[MasterPermission]    Script Date: 24/09/2020 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [Master].[MasterPermission]
(
    [Id]          int IDENTITY (1,1) NOT NULL,
    [Code]        [varchar](255)          NULL,
    [IdSubModule] int                NULL,
    PRIMARY KEY CLUSTERED
        (
         [Id] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
    CONSTRAINT [PK_MasterPermission] UNIQUE NONCLUSTERED
        (
         [Code] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [Master].[MasterRole]    Script Date: 24/09/2020 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [Master].[MasterRole]
(
    [Id]        int IDENTITY (1,1) NOT NULL,
    [Code]      [varchar](255)          NULL,
    [Label]     [varchar](255)          NULL,
    [IdCompany] [int]                   NULL,
    PRIMARY KEY CLUSTERED
        (
         [Id] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [Master].[MasterRolePermission]    Script Date: 24/09/2020 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [Master].[MasterRolePermission]
(
    [Id]           int identity(1,1) not null,
    [IdRole]       int NOT NULL,
    [IdPermission] int NOT NULL,
    [IsDeleted] BIT NOT NULL DEFAULT(0)
) ON [PRIMARY]
GO
ALTER TABLE [Master].[MasterRolePermission] ADD CONSTRAINT [PK_MasterRolePermission_Id] PRIMARY KEY CLUSTERED ([Id])

/****** Object:  Table [Master].[MasterRoleUser]    Script Date: 24/09/2020 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [Master].[MasterRoleUser]
(
    [Id] int identity(1,1) not null,
    [IdMasterUser] int   NOT NULL,
    [IdRole]       int   NOT NULL,
    [IsDeleted] BIT NOT NULL DEFAULT(0),
    [IdMasterCompany] int  NULL
) ON [PRIMARY]
GO
GO
ALTER TABLE [Master].[MasterRoleUser] ADD CONSTRAINT [PK_MasterRoleUser_Id] PRIMARY KEY CLUSTERED ([Id])
ALTER TABLE [Master].[MasterRoleUser] WITH NOCHECK
    ADD CONSTRAINT [FK_MasterRoleUser_MasterCompany] FOREIGN KEY ([IdMasterCompany]) REFERENCES [Master].[MasterCompany] ([Id]);

ALTER TABLE [Master].[MasterRoleUser] WITH CHECK CHECK CONSTRAINT [FK_MasterRoleUser_MasterCompany];
/****** Object:  Table [Master].[MasterSubModule]    Script Date: 24/09/2020 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [Master].[MasterSubModule]
(
    [Id]       int IDENTITY (1,1) NOT NULL,
    [Code]     [varchar](255)          NULL,
    [IdModule] int                NULL,
    PRIMARY KEY CLUSTERED
        (
         [Id] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
    CONSTRAINT [PK_MasterSubModule] UNIQUE NONCLUSTERED
        (
         [Code] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER TABLE [Master].[MasterPermission]
    WITH CHECK ADD CONSTRAINT [FK_MasterPermission_MasterSubModule] FOREIGN KEY ([IdSubModule])
        REFERENCES [Master].[MasterSubModule] ([Id])
GO
ALTER TABLE [Master].[MasterPermission]
    CHECK CONSTRAINT [FK_MasterPermission_MasterSubModule]
GO
ALTER TABLE [Master].[MasterRole]
    WITH CHECK ADD CONSTRAINT [FK_MasterRole_MasterCompany] FOREIGN KEY ([IdCompany])
        REFERENCES [Master].[MasterCompany] ([Id])
GO
ALTER TABLE [Master].[MasterRole]
    CHECK CONSTRAINT [FK_MasterRole_MasterCompany]
GO
ALTER TABLE [Master].[MasterRolePermission]
    WITH CHECK ADD CONSTRAINT [FK_MasterPermission_MasterRole] FOREIGN KEY ([IdRole])
        REFERENCES [Master].[MasterRole] ([Id])
GO
ALTER TABLE [Master].[MasterRolePermission]
    CHECK CONSTRAINT [FK_MasterPermission_MasterRole]
GO
ALTER TABLE [Master].[MasterRolePermission]
    WITH CHECK ADD CONSTRAINT [FK_MasterRolePermission_MasterPermission] FOREIGN KEY ([IdPermission])
        REFERENCES [Master].[MasterPermission] ([Id])
GO
ALTER TABLE [Master].[MasterRolePermission]
    CHECK CONSTRAINT [FK_MasterRolePermission_MasterPermission]
GO
ALTER TABLE [Master].[MasterRoleUser]
    WITH CHECK ADD CONSTRAINT [FK_MasterRoleUser_MasterRole] FOREIGN KEY ([IdRole])
        REFERENCES [Master].[MasterRole] ([Id])
GO
ALTER TABLE [Master].[MasterRoleUser]
    CHECK CONSTRAINT [FK_MasterRoleUser_MasterRole]
GO
ALTER TABLE [Master].[MasterRoleUser]
    WITH CHECK ADD CONSTRAINT [FK_MasterRoleUser_MasterUser] FOREIGN KEY ([IdMasterUser])
        REFERENCES [Master].[MasterUser] ([Id])
GO
ALTER TABLE [Master].[MasterRoleUser]
    CHECK CONSTRAINT [FK_MasterRoleUser_MasterUser]
GO
ALTER TABLE [Master].[MasterSubModule]
    WITH CHECK ADD CONSTRAINT [FK_MasterSubModule_MasterModule] FOREIGN KEY ([IdModule])
        REFERENCES [Master].[MasterModule] ([Id])
GO
ALTER TABLE [Master].[MasterSubModule]
    CHECK CONSTRAINT [FK_MasterSubModule_MasterModule]
GO



GO
/****** Object:  Table [dbo].[oauth_client_details]    Script Date: 18/09/2020 11:33:25 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[oauth_client_details]
(
    [client_id]               [varchar](255) NOT NULL,
    [client_secret]           [varchar](255) NULL,
    [resource_ids]            [varchar](255) NULL,
    [scope]                   [varchar](50)  NULL,
    [authorized_grant_types]  [varchar](255) NULL,
    [web_server_redirect_uri] [varchar](255) NULL,
    [authorities]             [varchar](255) NULL,
    [access_token_validity]   [int]          NULL,
    [refresh_token_validity]  [int]          NULL,
    [additional_information]  [varchar](255) NULL,
    [autoapprove]             [varchar](255) NULL,
    CONSTRAINT [PK_oauth_client_details] PRIMARY KEY CLUSTERED
        (
         [client_id] ASC
            ) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

GO

/****** Object:  Table [dbo].[oauth_access_token]    Script Date: 11/02/2021 10:53:27 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[oauth_access_token](
	[token_id] [varchar](max) NULL,
	[token] [varbinary](max) NULL,
	[authentication_id] [varchar](max) NULL,
	[user_name] [varchar](max) NULL,
	[client_id] [varchar](max) NULL,
	[authentication] [varbinary](max) NULL,
	[refresh_token] [varchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO


GO

/****** Object:  Table [dbo].[oauth_refresh_token]    Script Date: 11/02/2021 11:07:15 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[oauth_refresh_token](
	[token_id] [varchar](max) NULL,
	[token] [varbinary](max) NULL,
	[authentication] [varbinary](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO



--- create table comptaDB 
CREATE TABLE [dbo].[DBComptaConfig](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[url] [nvarchar](255) NOT NULL,
	[username] [nvarchar](255) NOT NULL,
	[password] [nvarchar](255) NOT NULL,
	[driverClassName] [nvarchar](255) NOT NULL,
	[companyCode] [nvarchar](255) NOT NULL,
	[env] [nvarchar](255) NULL,
	[module] [nvarchar](255) NULL,
PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO




GO
/****** Object:  Table [dbo].[DBProductionConfig]    Script Date: 09/08/2021 11:11:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DBProductionConfig](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[url] [nvarchar](255) NOT NULL,
	[username] [nvarchar](255) NOT NULL,
	[password] [nvarchar](255) NOT NULL,
	[driverClassName] [nvarchar](255) NOT NULL,
	[companyCode] [nvarchar](255) NOT NULL,
	[env] [nvarchar](255) NULL,
	[module] [nvarchar](255) NULL,
PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
